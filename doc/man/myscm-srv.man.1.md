% MYSCM-SRV(1) myscm-srv User Manuals
% Patryk Bęza
% August 4, 2017

# NAME

`myscm-srv` - server side of the mySCM application managing software and
configuration of the GNU/Linux workstations.

mySCM is simple Software Configuration Management (SCM) tool for managing
software and configuration of the clients running GNU/Linux distributions.
This application is intended to create and customize GNU/Linux system image
that can be applied by the clients running `myscm-cli` application.

# SYNOPSIS

myscm-srv.py [*options*] *action*

# DESCRIPTION

This is (yet another) Software Configuration Management (SCM) tool that allows
automation of distributing similarly configured software to multiple clients.
This solution of the software distribution problem significantly differs from
major existing solutions (e.g. Puppet, Chef, Ansible and Salt) in terms of how
it works and how it is used.  In contrast to existing solutions, user using
running this application doesn't need to write complex configuration rules,
which describes in great detail the expected state of the client system.
Typical use case of using `myscm-srv` is as follows:

>  1. Scan freshly installed GNU/Linux reference system (a.k.a. server) with
>     `myscm-srv` `--scan` option.  Every `--scan` creates new directory with
>     summary of changes that occured on the reference system since last
>     `--scan` (see `--list-db` option).
>  1. Configure reference system in a way you want to configure clients'
>     systems.
>  1. Run `--scan` again to collect details of changes that you made since last
>     `--scan`.
>  1. Run `myscm-srv` with the `--gen-img` option that will create reference
>     system image which is `tar.gz` archive (a.k.a. mySCM system image) which
>     will be later applied by the clients using `myscm-cli` which is
>     `myscm-srv` counterpart.
>  1. Copy mySCM system image to the client's system.
>  1. Apply mySCM reference system image by running `myscm-cli` application.

You can configure scope of the scanned directories by editing
`/etc/myscm-srv/scanned.aide` configuration file which uses AIDE syntax
extended with special kind of `#@` comments that indicate which of the scanned
directories or files should be copied between successive scans to be able to
create patches (a.k.a. diffs) instead of copying whole files to the myscm
system image.

There are also special template files that are recognized by `.myscm-template`
filename extension.  Those files are allowed to contain placeholders which are
replaced with client-specific data (e.g. hostname) when running `mysm-cli` with
`--apply-img` option.  If on the server's system there is scanned directory
that contains two regular files with filenames called `X` and
`X.myscm-template`, then only the latter taken into account.  `X` is ignored
because it presumably contains server-specific configuration (e.g. hostname).

This application is briefly referred as a `server`, but its primary role is not
to share the created system image with the clients (as its name may wrongly
suggest), but to create and customize GNU/Linux system image (see `--gen-img`
option) that can be applied by client's `myscm-cli` application, which modifies
client's system configuration to match server's reference configuration.
Sharing system image generated by this application is secondary in this project
and should be handled using e.g. SFTP which is supported by the `myscm-cli`
application.  Therefore, `myscm-srv` should be referred as a master or
reference system rather than the server.

Reference system image is an `.tar.gz` archive file that contains all of the
information needed by `myscm-cli` to modify clients' configuration and software
to make them clones of the `server` system in a sense described in `myscm-srv`
configuration; see `--aide-config` option).

# OPTIONS

Most of the below listed options have their counterparts in the `myscm-srv`
configuration file stored in `/etc/myscm-srv/config.ini`.  If option is present
both in configuration file and as a command line argument, then command line
argument takes precedence.  Some of the options have their default fallback
value even if they are not specified neither in configuration file nor as
command line option.

-a *PATH*, \--aide-config=*PATH*
:   Specify AIDE configuration file path.  This file determines which
    directories of the server's system are scanned and synchronized with the
    client's system.  If not specified `/etc/myscm-srv/aide.conf` AIDE
    configuration file is read by default.

-c *FILE*, \--config=*FILE*
:   Read `myscm-srv` configuration from specified *FILE* instead of default
    `/etc/myscm-srv/config.ini` file.  This file determines e.g. logging
    options, SSL certificate path that is used to digitally sign the myscm
    system image and more.

\--ssl-cert=*PATH*
:   Specify full path to the server's PEM formatted SSL certificate that is
    used to digitally sign system image generated with `--gen-img` option.  If
    this option is not present, then default path `/etc/myscm-srv/ssl.sig` is
    used.

\--ssl-cert-priv=*PATH*
:   Specify full path to the server's PEM formatted private key of the SSL
    certificate that is used to digitally sign system image generated with
    `--gen-img` option (see `--ssl-cert` option).  If this option is not
    present, then default path `/etc/myscm-srv/ssl.sig.priv` is used.

\--ssl-pubkey=*PATH*
:   Specify full path to the server's PEM formatted public key of the SSL
    certificate that is used to digitally sign system image generated with
    `--gen-img` option (see `--ssl-cert` option).

# ACTIONS

-k, \--config-check
:   Check if application configuration is valid.  If it's valid, then exit
    status is 0 (see `$?` variable) and `Config OK` message is printed on
    stdout.  Otherwise exit status is 1 and no message is printed.  This option
    checks both AIDE and `myscm-srv` configuration validity (see
    `--aide-config` and `--config`).

-s, \--scan
:   Scan system using AIDE, create AIDE's new `aide.db` reference database and
    rename old one to `aide.db.X` where `X` is incremented integer that is
    referred as `SYS_IMG_VER` in `--gen-img` option.  This operation is
    intended to provide AIDE database with a summary of the current state of
    the server software without deleting the old state file.  Scanning may take
    a long time to complete depending on the AIDE configuration file that
    determines which directories are scanned (see `--aide-config` option for
    details).

-g *SYS_IMG_VER*, \--gen-img=*SYS_IMG_VER*
:   Generate system image that can be applied by any client whose system
    configuration is represented by existing AIDE database identified by
    non-negative integer number `SYS_IMG_VER` which corresponds to `X` in
    `aide.db.X` file created with `--scan` flag (see `--list` option).
    Generated system image is an archive file saved in location specified in
    `/etc/myscm-srv/config.ini` configuration file (`/var/lib/myscm-srv/` is
    default).  System image contains all of the files necessary to modify
    client's configuration to match server's configuration.  If client has
    never synchronized its configuration with server, then `0` should be
    specified as a `SYS_IMG_VER`.  Client application (ie. `myscm-cli`) has
    option that prints out client's current `SYS_IMG_VER`.

\--upgrade *SYS_IMG_VER*
:   Run `myscm-srv` with `--scan` option and then with `--gen-img` option.

\--list-db
:   List all available AIDE databases created with `--scan` option.  Every line
    of the output is single full path to the respective aide.db[.X] AIDE
    database directory.  Location where aide.db[.X] files are saved is
    specified by AIDE configuration, specifically by the `database` variable
    read from file specified by the `--aide-config` option or from
    `/etc/myscm-srv/aide.conf` if `--aide-config` option is not present.

\--list-img
:   List all available mySCM system images created with `--gen-img` option.
    Every line of the output is single full path to the mySCM system image and
    message that informs whether within directory that contains listed mySCM
    system image is respective verified SSL digital signature of the mySCM
    system image.

-v, \--verbose
:   Increase output and log verbosity.  Default value is `0`.

-h, \--help
:   Show help message (which is short version of this manual page) and exit.

\--version
:   Print version information and exit.

# EXIT STATUS

If no error occurred the exit status is `0`.  Otherwise `1` is returned.

# COPYRIGHT

Copyright © 2017 Patryk Bęza  
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>.  
This is free software: you are free to change and redistribute it.  
There is NO WARRANTY, to the extent permitted by law.

# BUGS

Email bug reports to the bug-reporting address <bezap@student.mini.pw.edu.pl>.
For now, no bug tracker is available.

# SEE ALSO

`myscm-cli` (1).

You can learn more details about mySCM software from project white paper.  The
myscm-srv source code and all documentation may be downloaded from GitHub
repository of the project <https://github.com/pbeza/myscm>.

# NOTES

This software is part of the master thesis project.  To learn more about this
implementation, refer to project white paper.
